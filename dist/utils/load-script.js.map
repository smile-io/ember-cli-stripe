{"version":3,"file":"load-script.js","sources":["../../src/utils/load-script.js"],"sourcesContent":["import { isTesting, macroCondition } from '@embroider/macros';\n\nconst loadedScripts = {};\nlet loadScript;\n\nif (macroCondition(isTesting())) {\n  loadScript = async () => {\n    return Promise.resolve();\n  };\n} else {\n  /**\n   * Loads a script into a document, ensuring it's loaded only once when loading in the main browser\n   * document.\n   *\n   * @param {string} url        The script to load\n   * @param {object} opts       Options for loading the script\n   * @param {boolean} opts.async Optional. Whether to load the script asynchronously (default: true).\n   * @returns {Promise<void>}   Resolves when the script is successfully loaded.\n   */\n  loadScript = async (\n    url,\n    { async = true, onLoad = () => {}, onError = () => {} } = {},\n  ) => {\n    // Return cached promise if present\n    if (loadedScripts[url]) {\n      return loadedScripts[url];\n    }\n\n    // Create a new promise for loading the script\n    const promise = new Promise((resolve, reject) => {\n      const script = document.createElement('script');\n      script.type = 'text/javascript';\n      script.async = async;\n      script.src = url;\n\n      script.addEventListener(\n        'load',\n        () => {\n          onLoad();\n          resolve();\n        },\n        false,\n      );\n      script.addEventListener(\n        'error',\n        () => {\n          const error = new Error(`Could not load script: ${url}`);\n          onError(error);\n          reject(error);\n        },\n        false,\n      );\n\n      document.body.appendChild(script);\n    });\n\n    loadedScripts[url] = promise;\n\n    return promise;\n  };\n}\n\nexport { loadScript };\n"],"names":["loadedScripts","loadScript","macroCondition","isTesting","Promise","resolve","url","async","onLoad","onError","promise","reject","script","document","createElement","type","src","addEventListener","error","Error","body","appendChild"],"mappings":";;AAEA,MAAMA,aAAa,GAAG,EAAE;AACxB,IAAIC;AAEJ,IAAIC,cAAc,CAACC,SAAS,EAAE,CAAC,EAAE;EAC/BF,UAAU,GAAG,YAAY;AACvB,IAAA,OAAOG,OAAO,CAACC,OAAO,EAAE;GACzB;AACH,CAAC,MAAM;AACL;AACF;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACEJ,EAAAA,UAAU,GAAG,OACXK,GAAG,EACH;AAAEC,IAAAA,KAAK,GAAG,IAAI;AAAEC,IAAAA,MAAM,GAAGA,MAAM,EAAE;IAAEC,OAAO,GAAGA,MAAM;GAAI,GAAG,EAAE,KACzD;AACH;AACA,IAAA,IAAIT,aAAa,CAACM,GAAG,CAAC,EAAE;MACtB,OAAON,aAAa,CAACM,GAAG,CAAC;AAC3B;;AAEA;IACA,MAAMI,OAAO,GAAG,IAAIN,OAAO,CAAC,CAACC,OAAO,EAAEM,MAAM,KAAK;AAC/C,MAAA,MAAMC,MAAM,GAAGC,QAAQ,CAACC,aAAa,CAAC,QAAQ,CAAC;MAC/CF,MAAM,CAACG,IAAI,GAAG,iBAAiB;MAC/BH,MAAM,CAACL,KAAK,GAAGA,KAAK;MACpBK,MAAM,CAACI,GAAG,GAAGV,GAAG;AAEhBM,MAAAA,MAAM,CAACK,gBAAgB,CACrB,MAAM,EACN,MAAM;AACJT,QAAAA,MAAM,EAAE;AACRH,QAAAA,OAAO,EAAE;OACV,EACD,KACF,CAAC;AACDO,MAAAA,MAAM,CAACK,gBAAgB,CACrB,OAAO,EACP,MAAM;QACJ,MAAMC,KAAK,GAAG,IAAIC,KAAK,CAAC,CAA0Bb,uBAAAA,EAAAA,GAAG,EAAE,CAAC;QACxDG,OAAO,CAACS,KAAK,CAAC;QACdP,MAAM,CAACO,KAAK,CAAC;OACd,EACD,KACF,CAAC;AAEDL,MAAAA,QAAQ,CAACO,IAAI,CAACC,WAAW,CAACT,MAAM,CAAC;AACnC,KAAC,CAAC;AAEFZ,IAAAA,aAAa,CAACM,GAAG,CAAC,GAAGI,OAAO;AAE5B,IAAA,OAAOA,OAAO;GACf;AACH;;;;"}